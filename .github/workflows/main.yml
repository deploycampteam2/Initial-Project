name: Deploy to VPS Ubuntu 16.04

on: [push]

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Basic system info
        run: |
          echo "ğŸ¯ === DEPLOYMENT STARTED ==="
          echo "ğŸ“… Date: $(date)"
          echo "ğŸ‘¤ User: $(whoami)"
          echo "ğŸ–¥ï¸ Hostname: $(hostname)"
          echo "ğŸ“‚ Working Directory: $(pwd)"
          echo "ğŸ§ OS Info: $(cat /etc/os-release | head -2)"
          echo "ğŸ’¾ Memory: $(free -h | head -2)"
          echo "ğŸ’½ Disk: $(df -h / | tail -1)"
          
      - name: Deploy application
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          echo "ğŸš€ === DEPLOYING TO /home/ubuntu/initial_project ==="
          
          # Navigate to home directory
          cd /home/ubuntu
          
          # Backup existing project if exists
          if [ -d "initial_project" ]; then
            echo "ğŸ“¦ Backing up existing project..."
            mv initial_project initial_project_backup_$(date +%Y%m%d_%H%M%S)
          fi
          
          # Clone repository using token
          echo "ğŸ“¥ Cloning repository..."
          git clone https://$GH_TOKEN@github.com/$GITHUB_REPOSITORY.git initial_project
          
          # Navigate to project directory
          cd initial_project
          
          echo "âœ… Repository cloned successfully to /home/ubuntu/initial_project"
          echo "ğŸ“‹ Files in project:"
          ls -la
          
          echo "ğŸ“ Current location: $(pwd)"