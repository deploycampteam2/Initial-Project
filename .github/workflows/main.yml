name: Deploy to VPS Ubuntu 16.04

on: [push]

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Basic system info
        run: |
          echo "🎯 === DEPLOYMENT STARTED ==="
          echo "📅 Date: $(date)"
          echo "👤 User: $(whoami)"
          echo "🖥️ Hostname: $(hostname)"
          echo "📂 Working Directory: $(pwd)"
          echo "🐧 OS Info: $(cat /etc/os-release | head -2)"
          echo "💾 Memory: $(free -h | head -2)"
          echo "💽 Disk: $(df -h / | tail -1)"
          
      - name: Deploy application
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          echo "🚀 === DEPLOYING TO /home/ubuntu/initial_project ==="
          
          # Navigate to home directory
          cd /home/ubuntu
          
          # Backup existing project if exists
          if [ -d "initial_project" ]; then
            echo "📦 Backing up existing project..."
            mv initial_project initial_project_backup_$(date +%Y%m%d_%H%M%S)
          fi
          
          # Clone repository using token
          echo "📥 Cloning repository..."
          git clone https://$GH_TOKEN@github.com/$GITHUB_REPOSITORY.git initial_project
          
          # Navigate to project directory
          cd initial_project
          
          echo "✅ Repository cloned successfully to /home/ubuntu/initial_project"
          echo "📋 Files in project:"
          ls -la
          
          echo "📍 Current location: $(pwd)"